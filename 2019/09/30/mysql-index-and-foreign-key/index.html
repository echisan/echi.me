

<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>
    <title>mysql-索引与外键 - EchisanBlog</title>
<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="author" content="John Doe">
<meta name="description" content="innodb存储引擎索引概述innodb常见的索引

B+树索引
全文索引
哈希索引


B+树索引并不能找到一个...">
<meta name="keywords" content="">

    <meta charset="utf-8">
    <meta name="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="telephone=no" name="format-detection">
    <meta name="renderer" content="webkit">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/journal.css?83711079">

<script src="/js/loadCSS.js"></script>
<script>
    loadCSS("https://fonts.googleapis.com/css?family=Lora|Montserrat|Fira+Mono|Material+Icons");
    (function (d) {
        var config = {
                kitId: 'dwg1tuc',
                scriptTimeout: 3000,
                async: true
            },
            h = d.documentElement, t = setTimeout(function () {
                h.className = h.className.replace(/\bwf-loading\b/g, "") + " wf-inactive";
            }, config.scriptTimeout), tk = d.createElement("script"), f = false,
            s = d.getElementsByTagName("script")[0], a;
        h.className += " wf-loading";
        tk.src = 'https://use.typekit.net/' + config.kitId + '.js';
        tk.async = true;
        tk.onload = tk.onreadystatechange = function () {
            a = this.readyState;
            if (f || a && a != "complete" && a != "loaded") return;
            f = true;
            clearTimeout(t);
            try {
                Typekit.load(config)
            } catch (e) {
            }
        };
        s.parentNode.insertBefore(tk, s)
    })(document);
</script>
<noscript>
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Lora|Montserrat|Anonymous+Pro:400|Material+Icons"/>
</noscript>
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="EchisanBlog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>
<body>
<div id="top"></div>
<div id="app">
<div class="single-column-drawer-container" ref="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            <a class="a-block drawer-menu-item false" href="http://example.com">
                Home
            </a>
            

            
            
            <a class="a-block drawer-menu-item false" href="/about/index.html">
                关于我
            </a>
            
            <a class="a-block drawer-menu-item false" href="/search/index.html">
                search
            </a>
            
            <a class="a-block drawer-menu-item false" href="/tags/index.html">
                tags
            </a>
            

            
        </div>
    </div>
</div>
<transition name="fade">
    <div v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav ref="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div ref="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a ref="navTitle" class="navbar-brand" href="/">
            EchisanBlog
        </a>
    </div>
</nav>
<div class="single-column-header-container" ref="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="/">
        <div class="single-column-header-title">EchisanBlog</div>
        <div class="single-column-header-subtitle"></div>
    </a>
</div>
<div ref="sideContainer" class="side-container">
    <a class="a-block nav-head false" href="/">
        <div class="nav-title">
            Echisan.
        </div>
        <div class="nav-subtitle">
            吃西瓜不吐籽
        </div>
    </a>

    <div class="nav-link-list">
        

        
        
        <a class="a-block nav-link-item false" href="/about/index.html">
            关于我
        </a>
        
        <a class="a-block nav-link-item false" href="/search/index.html">
            search
        </a>
        
        <a class="a-block nav-link-item false" href="/tags/index.html">
            tags
        </a>
        

        
    </div>

    
    <div class="nav-footer">
        Proudly published with Hexo<br>
        
        Theme <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> by <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a><br>
        
        &copy; 2021 <a href="http://example.com">EchisanBlog</a>
    </div>
</div>
<div ref="extraContainer" class="extra-container">
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>

        
    </div>
</div>



<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            <div class="post-head-wrapper-text-only"
                 style="background-image: url('')">
                <div class="post-title">
                    mysql-索引与外键
                    <div class="post-meta">
                        <time datetime="2019-09-30T03:42:18.000Z" itemprop="datePublished">
                            2019-09-30 11:42
                        </time>&nbsp;
                        
    
                        
                        
                        <i class="material-icons" style="">label</i>
                        
                        <a href='/tags/mysql/'>mysql</a>, 
                        
                        <a href='/tags/innodb/'>innodb</a>
                        
                        
                    </div>
                </div>
            </div>
    
            <div class="post-body-wrapper">
                <div class="post-body">
                    <h2 id="innodb存储引擎索引概述"><a href="#innodb存储引擎索引概述" class="headerlink" title="innodb存储引擎索引概述"></a>innodb存储引擎索引概述</h2><p>innodb常见的索引</p>
<ul>
<li>B+树索引</li>
<li>全文索引</li>
<li>哈希索引</li>
</ul>
<blockquote>
<p>B+树索引并不能找到一个给定键值的具体行。B+树索引能找到的只是被查找数据行所在的页。然后数据库通过页读入到内存，再在内存中进行查找，最后得到要查找的数据。</p>
</blockquote>
<h2 id="数据结构和算法"><a href="#数据结构和算法" class="headerlink" title="数据结构和算法"></a>数据结构和算法</h2><blockquote>
<p>晚点去学习下B+树</p>
</blockquote>
<h2 id="B-树索引"><a href="#B-树索引" class="headerlink" title="B+树索引"></a>B+树索引</h2><blockquote>
<p>B+索引在数据库中又一个特点是高扇出性，因此在数据库中，B+树的高度一般在2～4层。</p>
</blockquote>
<blockquote>
<p>数据库中B+树索引可以分为聚集索引和辅助索引，但其内部都是B+树，即高度平衡的，叶子节点存放着所有的数据。聚集索引与辅助索引不同的是，叶子节点存放的是否是一整行的信息</p>
</blockquote>
<h2 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a>聚集索引</h2><blockquote>
<p>innodb存储引擎表是索引组织表，即表中数据按主键顺序存放。而聚集索引(clustered index)就是按照每张表的主键构造一棵B+树，同时<strong>叶子节点中存放的即为整张表的行记录数据</strong>，也将聚集索引的叶子节点成为数据页。聚集索引的这个特性决定了索引组织表中数据也是索引的一部分。同B+树数据结构一样，每个数据页都通过一个双向链表来进行链接</p>
</blockquote>
<h2 id="辅助索引-Secondary-Index-也称非聚集索引"><a href="#辅助索引-Secondary-Index-也称非聚集索引" class="headerlink" title="辅助索引(Secondary Index,也称非聚集索引)"></a>辅助索引(Secondary Index,也称非聚集索引)</h2><blockquote>
<p>叶子节点并不包含行记录的全部数据。叶子节点除了包含键值以外，每个叶子节点中的索引行中还包含了一个书签(bookmark)</p>
</blockquote>
<p>书签  </p>
<blockquote>
<p>该书签用来告诉InnoDB存储引擎哪里可以找到与索引相对应的行数据。由于InnoDB是索引组织表，因此InnoDB的辅助索引的书签就是相应行数据的聚集索引键。</p>
</blockquote>
<h2 id="B-树索引的分裂"><a href="#B-树索引的分裂" class="headerlink" title="B+树索引的分裂"></a>B+树索引的分裂</h2><p>没看懂</p>
<h2 id="Cardinality"><a href="#Cardinality" class="headerlink" title="Cardinality"></a>Cardinality</h2><p>如何查看索引是否是高选择性？</p>
<p>可以通过<code>show index</code>结果中的列<code>Cardinality</code>来观察。Cardinality值非常关键，表示索引中不重复记录的预估值。值得注意的是该值是一个预估值并不是准确的值。实际应用中<code>Cardinality/n_rows_in_table</code>应尽可能地接近1.</p>
<h2 id="Multi-Range-Read优化"><a href="#Multi-Range-Read优化" class="headerlink" title="Multi-Range Read优化"></a>Multi-Range Read优化</h2><p>MySQL5.6开始支持Multi-Range Read(MRR)优化，MRR优化的目的为了减少磁盘的随机访问，并将随机访问转化为较为顺序的数据访问，这对IO-bound类型的SQL查询语句可带来性能极大的提升。MRR优化可适用于range，ref，eq_ref类型的查询。</p>
<p>MRR优化有以下几个好处</p>
<ul>
<li>MRR使数据访问变得较为顺序。在查询辅助索引时，首先根据得到的查询结果按照主键进行排序，并且按照主键排序的顺序进行书签查找</li>
<li>减少缓冲池中页被替换的次数</li>
<li>批量处理对键值的查询操作</li>
</ul>
<p>对于InnoDB和MyISAM的范围查询和JOIN查询操作，MRR工作方式如下：</p>
<ul>
<li>将查询得到的辅助索引键值存放于一个缓存中，这时缓存中的数据是根据辅助索引键值排序的</li>
<li>将缓存中的键值根据RowID进行排序</li>
<li>根据RowID的排序顺序来访问实际的数据文件</li>
</ul>
<blockquote>
<p>此外，若InnoDB或MyISAM缓冲池不是足够大，不能放下一张表中的所有数据，此时频繁的离散读操作还会导致缓存中的页被替换出缓冲池，然后又不断地读入缓冲池。若是按照主键顺序进行访问，则可以将此重复行为降为最低</p>
</blockquote>
<h2 id="Index-Condition-Pushdown-ICP-优化"><a href="#Index-Condition-Pushdown-ICP-优化" class="headerlink" title="Index Condition Pushdown (ICP) 优化"></a>Index Condition Pushdown (ICP) 优化</h2><p>ICP同样是MySQL5.6开始支持的一种根据索引进行查询的优化方式。</p>
<p>之前的MySQL版本不支持ICP的话，当进行索引查询时，首先根据索引来查找记录，然后再根据<code>WHERE</code>条件来过滤记录。</p>
<p>在支持ICP之后，<code>WHERE</code>操作放在了存储引擎层，在取出索引的同时根据<code>WHERE</code>条件过滤。在某些查询下，可以大大减少上层SQL层对记录的索取，从而提高数据库的整体性能。</p>
<h2 id="哈希算法"><a href="#哈希算法" class="headerlink" title="哈希算法"></a>哈希算法</h2><h3 id="InnoDB中的哈希算法"><a href="#InnoDB中的哈希算法" class="headerlink" title="InnoDB中的哈希算法"></a>InnoDB中的哈希算法</h3><p>对于缓冲池的哈希表来说，在缓冲池中的Page都有一个<code>chain</code>指针，他指向相同哈希函数值的页。</p>
<blockquote>
<p>对于除法散列，m的取值为略大于2倍的缓冲池页的质数。例如：当前参数<code>innodb_buffer_pool_size</code>的大小为10M，则公有640个16kb的页。对于缓冲池内存的哈希表来说，需要分配640*2=1280个槽，但是由于128不是质数，需要取比1280略大的质数，应该是1399，所以启动时会分配1399个槽的哈希表。</p>
</blockquote>
<p>那么innodb的缓冲池对于其中的页是怎么进行查找的？</p>
<p>innodb的表空间都有一个space<code>_id</code>，用户要查找的应该是某个表空间的某个连续16kb的页，即偏移量offset。innodb将<code>space_id</code>左移20位，然后加上这个<code>space_id</code>和offset，即关键字<code>K=space_id&lt;&lt;20 + space_id + offset</code>，然后通过除法散列到各个槽中去。</p>

                </div>
            </div>
    
            <nav class="post-pagination">
    
    <a class="newer-posts" href="/2019/09/30/mysql-lock/">
        Previous post<br>mysql-锁
    </a>
    
    <span class="page-number"></span>
    
    <a class="older-posts" href="/2019/09/24/mysql-features/">
        Next post<br>mysql-特性
    </a>
    
</nav>

    
            


        </div>
    </div>
    <div class="single-column-footer">
    Proudly published with Hexo<br>
    
    Theme <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> by <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a><br>
    
    &copy; 2021 <a href="http://example.com">EchisanBlog</a>
</div>
</div>

</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"
        integrity="sha256-EGs9T1xMHdvM1geM8jPpoo8EZ1V1VRsmcJz8OByENLA=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.min.js"
        integrity="sha256-FtWfRI+thWlNz2sB3SJbwKx5PgMyKIVgwHCTwa3biXc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/smooth-scroll@14.2.1/dist/smooth-scroll.polyfills.min.js"
        integrity="sha256-CI4Gq5E0io1Pv0xM3qPM+NUIOhbIBvC3GiN1Y4KhXpw=" crossorigin="anonymous"></script>
<script src="/js/journal.js?256844"></script>



</body>
</html>
